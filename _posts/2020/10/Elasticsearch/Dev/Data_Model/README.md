## Elasticsearch数据建模实例
-----

### 1. 什么是数据建模

数据建模(data modeling)是创建数据模型的过程

数据模型是对真实世界进行抽象描述的一种工具和方法，实现对现实世界的映射

```text
博客/作者/用户评论
```

三个过程： 概念模型 -> 逻辑模型 -> 数据模型(第三范式)

数据模型： 结合具体的数据库，在满足业务读写性能等需求的前提下，确定最终的定义。


### 2. 如何对字段进行建模

对字段的建模主要分为四大部分来考虑：

1. 字段类型
1. 是否要搜索及分词
1. 是否要聚合及排序
1. 是否要额外的存储

### 2.1. 字段类型 Text v.s keyword

**Text**

用于全文本字段，文本会被Analyzer分词

默认不支持聚合分析及排序。需要设置filedata为true

**keyword**

用于id、枚举及不需要分词的文本。例如电话号码、email地址、手机号码、邮政编码、性别等

适用于Filter(精确匹配)，Sorting和Aggregations

**设置多字段类型**

默认会为文本类型设置成text,并且设置一个keyword的子字段

在处理人类语言时，通过增加"英文"、"拼音"和"标准"分词器，提高搜索结构

### 2.2. 字段类型： 结构化数据

**数值类型**

尽量选择贴近的类型。例如可以用byte，就不要用long

**枚举类型**

设置为keyword。即便是数字，也应该设置成keyword，获取更好的性能

**其他**

日期/布尔/地理信息


### 3. 从搜索的角度如何数据建模

如不需要检索、排序和聚合分析

Enable设置成false

如不需要检索

index设置成false

对需要检索的字段，可以通过如下配置，设定存储粒度

index options/ Norms: 不需要归一化数据时，可以关闭


### 4. 从聚合和排序的角度思考数据建模

如不需要检索、排序和聚合分析

Enable设置成false

如不需要排序或者聚合分析功能

Doc_values/ fielddata 设置成false

更新频繁，聚合查询频繁的keyword类型的字段

推荐将eager_global_ordinals设置成true


### 5. 是否需要增加额外的存储

是否需要专门存储当前字段数据

**store设置成true**，可以存储该字段的原始内容。

一般集合_source的enabled为false时候使用

**Disable _source**：节约磁盘；适用于指标类型数据

一般建议先考虑增加压缩比

无法看到_source字段，无法做Reindex，无法做Update
